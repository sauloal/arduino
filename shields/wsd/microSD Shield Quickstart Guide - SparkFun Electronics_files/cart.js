(function(b){var a={init:function(c){},add:function(e,d){var c=this;b.post("/cart/add.json",this.serialize(),function(f){if(!f.success){alert(f.message)}else{var g=b(c).find("[name=id]").val();b("#added_qty_"+g).html(parseInt(f.qty_added));b("#items_in_cart").html(parseInt(b("#items_in_cart").html())+parseInt(f.qty_added));b("#added_to_cart_"+g).show().effect("highlight",{},1500);b("#cart-menu-item").effect("highlight",{},1500)}})},remove:function(c){b.post("/cart/remove.json",{id:c},function(d){success=d.success;if(success||null==success){b("#cart_row_"+c).slideUp(500,function(){b(this).remove();b(this).cart("recalculate_totals")})}else{window.top.location.reload()}})},remove_all:function(){b.post("/cart/remove_all.json",{},function(c){if(!c.success){window.top.location.reload()}b(".cart-row").each(function(d){b(this).slideUp(2000)});b(".cart-row").promise().done(function(){this.remove();b("#cart").cart("recalculate_totals")})})},recalculate_totals:function(){var d=0;var c=0;b(".cart-row").each(function(f,g){c+=parseFloat(b(g).find(".price").attr("data-price"));d+=parseInt(b(g).find(".add-qty").val())});b("#cart_total").find(".price").removeClass("calculated").html(c.toFixed(2));b("#items_in_cart").html(d);b("#airlock").currency("render");if(!b(".cart-row")[0]){b("#remove_all").fadeOut();b("#checkout").fadeOut();b("#internal_checkout").fadeOut();b("#load_shipping_quotes").fadeOut();b("#cart_footer .note").fadeOut();b("#calculate_shipping").fadeOut()}},confirm_backorder:function(h,g){try{if(b("#backorder-dialog")[0]){b("#backorder-dialog").slideUp(function(){b("backorder-dialog").remove()})}}catch(f){}var d=b("<div />",{id:"backorder-dialog",style:"display: none; width: 300px"}).addClass("dialog");var c=b("<ul />");var e=b("<a />",{id:"backorder-dialog-cancel",href:"#"}).addClass("cancel button").html("Cancel");e.click(function(){b("#backorder-dialog").slideUp(function(){b("#backorder-dialog").remove()})});d.css("top",b(this).offset().top+(b(this).height()+10)+"px");d.css("left",b(this).offset().left-(parseInt(d.css("width"))-b(this).width()+10)+"px");d.html('<h3>Backorder Item</h3><p>This item is not in stock. If you would like to order the item now, add it to your cart and check out when you\'re ready. We will charge you and ship your order as soon as it becomes available. This will guarantee that you get placed into the order queue and stock will be set aside for your order.</p><p>Backordered items may require additional shipping charges. Please see our <a href="http://www.sparkfun.com/commerce/static.php?name=customer_service#BackOrders" target="_blank">Backorder Policy</a> for more information. Most items ship within 2-3 weeks. Some items have extended lead times.</small></p>');d.append(e);link=b("<a />",{href:"#"}).addClass("button").html("Backorder Item");link.click(function(){d.slideUp(function(){b(this).closest("form").cart("add",h,g)})});d.append(link);b(this).closest("form").append(d);b(d).slideDown(100)},ask_which_address:function(c){var c=[];b.get("/cart/addresses.json",function(f){c=f.addresses;var e=b("#shipping_calculator").html("<h4>Please select an address</h4>"),d=b("<ul />");b.each(c,function(j,h){var k=h.entry_street_address+"<br/>"+h.entry_city+(h.entry_state?", "+h.entry_state:"")+" "+h.entry_postcode;var g=b("<li />",{"class":"address"});var i=b("<a />",{href:"#",html:k,click:function(l){l.preventDefault();b(this).cart("show_shipping_quotes",h)}});g.append(i);d.append(g)});d.append(b("<li />",{"class":"address",html:b("<a />",{href:"/addresses","class":"button",text:"Edit or add a new shipping address"})}));e.append(d);e.show("blind",{},300)})},show_shipping_quotes:function(c){var d=b("#shipping_calculator");d.html(b("<img />",{src:window.SFECONFIG.http_static+"/images/framework/666_loader.gif"}));b.ajax({url:"/cart/shipping_dinosaur.json",data:{address_book_id:c.address_book_id},success:function(e){var f=b("<ul />");if(e){b.each(e,function(i,h){var g=b("<li />");g.html('<span class="method_name">'+h.name+':</span> <span class="method_price price">'+h.cost+"</span>");f.append(g);d.html(f);d.append("<br /><b>Shipping to:</b><br />"+c.entry_street_address+"<br />"+c.entry_city+(c.entry_state?", "+c.entry_state:"")+" "+c.entry_postcode+"<br /><br />");b("#airlock").currency("render");d.append(b("<a />",{href:"javascript: void(0);","class":"button",text:"Select another address",click:function(j){j.preventDefault();b(this).cart("ask_which_address")}}))})}else{d.html("<h3>Unable to retrieve quotes</h3><p>We were unable to retrieve quotes for this order. This is likely due to the weight of the items in your cart. You may still place this order, and we will contact you with shipping options within 2 business days</p>")}}})},ask_autonotify:function(g,l){if(b("#autonotify-dialog")[0]){b("#autonotify-dialog").slideUp(100,function(){b("#autonotify-dialog").remove()})}var j=b("<div />",{id:"autonotify-dialog",style:"display: none; width: 300px"}).addClass("dialog");var i=b("<div />",{id:"autonotify-dialog-content"}).addClass("autonotify");var f=b(this).offset();j.css("top",f.top+(b(this).height()+10)+"px");j.css("left",f.left-(parseInt(j.css("width"))-b(this).width()+10)+"px");i.html("<h3>Autonotify</h3><p>This item is not in stock. If you would like an email sent to you when this product becomes available, please press the Autonotify button below.</p><p>By default, the autonotification will be sent to your account's default email address. If you would like the autonotification sent to a different email address please select the <b>Use alternate email</b> option below and enter a valid address.</p>");var k=b("<a />",{id:"autonotify-dialog-cancel",href:"javascript:void(0)"}).addClass("cancel button").html("cancel");k.click(function(){b("#autonotify-dialog").slideUp(100,function(){b("#autonotify-dialog").remove()})});var e=b("<input />",{id:"use-alt-email",type:"checkbox",style:"vertical-align: middle;"});var d=b("<input />",{id:"alt-email",type:"email",value:l,style:"display: none; margin-top: 5px;"});var h=b("<div />",{id:"error-message",style:"display: none; width: 95%; color: red; font-style: italic; font-weight: normal; margin-top: 5px; margin-left: 3px;"});e.click(function(){b("#alt-email").toggle();b("#error-message").hide()});var c=b("<a />",{id:"autonotify-dialog-confirm",href:"javascript: void(0)"}).addClass("confirm button").html("Autonotify");c.click(function(){var n=b("#use-alt-email").val();var m=b("#alt-email").val().replace(/ /g,"");if(n&&m.length==0){b("#error-message").html("Please enter something!");b("#error-message").show();return false}b.post("/autonotify/add.json",{id:g,email:m},function(o){if(o.success){b("#autonotify-dialog").slideUp(100,function(){b("#autonotify-dialog").remove()});location.reload()}else{b("#error-message").html(o.error);b("#error-message").show()}})});i.append(e);i.append(b("<span />",{style:"vertical-align: middle; padding-top: 5px;"}).html("<b>Use alternate email</b>"));i.append(b("<br />"));i.append(d);i.append(h);j.append(i);j.append(b("<br />"));j.append(c);j.append(k);b("#center").append(j);b(j).slideDown(100)},autonotify_email_update:function(f){var h=b("#customer-email-address-"+f).html();if(b("#update-email-dialog")[0]){b("#update-email-dialog").slideUp(100,function(){b("#update-email-dialog").remove()})}var g=b("<div />",{id:"update-email-dialog",style:"display: none; width: 255px;"}).addClass("dialog");g.css("top",b(this).offset().top+(b(this).height()+10)+"px");g.css("left",b(this).offset().left-(parseInt(g.css("width"))-b(this).width()+10)+"px");g.html('<div style="margin-top: 3px; margin-bottom: 5px;">Please enter a new email address:</div>');var e=b("<input />",{type:"email",id:"customer-email",value:h,style:"width: 150px;"});var c=b("<input />",{type:"button",id:"ok-button",value:"ok",style:""});var d=b("<input />",{type:"button",id:"cancel-button",value:"cancel",style:"margin-left: 3px;"});var i=b("<div />",{id:"update-email-error",style:"display: none; width: 95%; color: red; font-style: italic; font-weight: normal; margin-top: 5px; margin-left: 3px;"});c.addClass("button");d.addClass("button");c.click(function(){var j=b("#customer-email").val().replace(/ /g,"");b.post("/autonotify/update.json",{id:f,customer_email:j},function(k){if(!k.success){b("#update-email-error").html(k.error);b("#update-email-error").show()}else{b("#update-email-dialog").remove();b("#customer-email-address-"+f).html(j)}})});d.click(function(){if(b("#update-email-dialog")[0]){b("#update-email-dialog").slideUp(100,function(){b("#update-email-dialog").remove()})}});g.append(e);g.append(c);g.append(d);g.append(i);b("#center").append(g);b(g).slideDown(100)}};b.fn.cart=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{b.error("Method "+c+" does not exist on jQuery.cart")}}}})(jQuery);